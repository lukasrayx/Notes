https://blog.csdn.net/iwanderu/article/details/103802457

# 第二章：物理层

1 码元 可以携带 n 比特 信息量

信道一般表示向一个方向传输信息的媒体。所以通信线路往往包含一条发送信息的信道和一条接收信息的信道。
->**单向通信(单工通信)**——只能有一个方向的通信，没有反向交互。
->双向交替通信(**半双工通信**)——通信的双方都可以发送信息，但是<u>不能双方同时</u>发送或接收。
->双向同时通信(**全双工通信**)——通信的双发<u>可以同时</u>发送和接收。

## 2.2.3 基带(baseband)和带通(base pass)信号

**基带信号**(基本频率信号)——**来自信源**的信号，例如计算机输出的代表各种文字或图像文件的数据信号都属于基带信号。基带信号就是发出的直接表达了要传输的信息的信号，比如说我们说话的声波。
**带通信号**——把**基带信号**经过<u>载波调制后</u>，把信号的频率范围迁移到较高的频段以便在信道中传输(即仅在一段频率范围内能够通过信道)。

在传输距离较近时，采用基带传输方式(衰减不大，信号内容不会变化)。传输距离较远时，采用带通传输方式，例如从计算机到监视器，打印机等外设的信号。



## 2.2.4 几种基本的调制方法

调幅(AM)，调频(FM)，调相(PM)

![](https://i.imgur.com/twhluPu.png)



## 2.2.5 常用编码方式

![](https://i.imgur.com/XXOfRws.jpg)

![](https://i.imgur.com/CZSznLc.png)



## 2.2.7 奈氏(Nyquist)准则

在**理想条件**下(<u>无噪声/干扰/失真</u>)，为了**避免码间串扰**，码元的传输速率是**有上限**的。如果信道的频带越宽(信号高频分量越多)，则用更高的速率传输码元也不会出现码间串扰。

**适用于模拟信号**

## 2.2.8 信噪比和香农(Shannon)公式

信道的极限信息传输速率C(带宽受限且<u>有Gauss白噪声干扰</u>时的信道极限且无差错时的信息传输速率)可表示为:

- **C = W log2(1 + S / N) b/s**
- ->W是信道的带宽(Hz)；
- ->S是信道内所传信号的平均功率；
- ->N是信道内的Gauss噪声的功率。

- 信噪比(S/N)越大，则信息的极限传输速率C就越高；
- 只要信息传输速率**小于**信道的极限传输速率C，就一定能实现某种无差错传输
- **适用于数字+模拟信号**

![](https://i.imgur.com/Mkm8HJv.png)



## 2.3 物理层下面的传输介质

### 2.3.1 导向传输媒体

- 双绞线 （铜线拧在一起：降低电磁干扰）
  - 屏蔽双绞线  STP
  - 无屏蔽双绞线  UTP （多了屏蔽层）
- 同轴电缆 （少用）
- 光缆

**交换机：**

简单说，就是记录一下哪个端口上有哪个MAC地址，形成一个MAC地址和端口的绑定表，按照这个表转发数据。交换机那全部转发的前提是在同一个VLAN内，并且在同一个网段（更专业的说法是在同一个网络）内。和原来的HUB（集线器）对比的话，交换机构建的是广播域，集线器构建的是冲突域。

**集线器Hub：** (带宽所有连接的计算机共用)
在网络中只起到信号放大和重发作用，目的是扩大网络的传输范围，而不具备信号的定向传送能力。（现在很少用集线器了，它不安全，<u>一般用交换机</u>。）



## 2.4 信道复用技术

复用(multiplexing)是通信技术中的基本概念。

![](https://i.imgur.com/C7Zax1B.png)

### 2.4.1 频分复用(FDN: frequency division multiplexing)

用户在分配到一定的频带后，在通信过程中始终站用这个频带。频分复用的所有用户在同样的时间占用不同的带宽资源(带宽指频率带宽不是数据的发送速率)。



### 2.4.2 时分复用(TDN: time division multiplexing)

时分复用可能会造成线路资源的浪费，由于计算机数据的突发性质，用户对分配到的子信道的利用率一般不高。



### 2.4.3 统计时分复用(STDM: statistic TDM)



### 2.4.4 波分复用(WDM: wavelength division multiplexing)

就是光的频分复用。



### 2.4.5 码分复用

常用的名词是码分多址CDMA(Code Division Multiple Access)
各用户使用经过特殊挑选的不同码型，因此彼此不会造成干扰。
这种系统发送的信号有很强的抗干扰能力，其频谱类似于白噪声，不易被敌人发现。
每一个比特时间划分为m个短的间隔，称为码片(chip)。



脉码调制(PCM)技术

ADSL

DMT技术

# 第三章：数据链路层

## 3.1.1 数据链路层的简单模型

数据链路层不关心物理层解决的问题，只关心**帧头帧尾和校验**。

**信道类型：**

- **点对点信道** ： PPP协议                长距离
- **广播信道**：       CSMA/CD协议     短距离

**3.1.2 链路与数字链路**

- **链路(link)**——是一条点到点的物理线路段，中间没有任何其他的交换节点。一条链路只是一条通路的一个组成部分。
- **数据链路(data link)**——除了物理线路外，还必须有<u>通信协议</u>来<u>控制这些数据的传输。</u>若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。最常用的方法是使用适配器(网卡)来实现这些协议的硬件和软件。一般的适配器都包括了数据链路层和物理层这两层的功能。

### 3.1.3 帧

在网络层，给数据包增加了接收端和发送端的IP地址。在数据链路层里，增加了<u>帧头帧尾，MAC地址和校验值</u>。

## 3.2 数据链路层解决的基本问题

### 3.2.1 封装成帧(framing)

就是在一段数据的前后分别添加帧头和帧尾，构成一个帧，确定帧的界限。

![](https://i.imgur.com/FCiaFII.png)

可能会出现以下问题

![](https://i.imgur.com/X82zsuF.png)



### 3.2.2 透明传输

用字节填充法解决透明传输问题。发送端的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面插入一个转义字符“ESC”(十六进制数1B)。
字节填充(byte stuffing)或字符填充(character stuffing)——接收端的数据链路层在数据送往网络层之前杀出插入的转义字符。
如果转义字符也出现在数据之中，那么应该在转义字符前插入一个转义字符。当接收端收到连续的两个转义字符时，就删除前面的那一个。

![](https://i.imgur.com/GsIE8J2.png)



### 3.2.3 差错校验

传输过程中可能会产生bit差错：0变成1，1变成0.
在一段时间内，传输错误的比特率占所传输比特总数的比率称为误码率BER(bit error rate)。
->循环冗余检验**CRC:**
除数必须比后面添加的0的位数多一位，可以是任意的二进制数。每一步运算其实是不进位的加法。下图的001就是FCS帧检验序列。接收端计算101001001(也就是原数据加上FCS)除以1101，如果<u>商为0</u>，意味着传输过程<u>没有差错</u>，就接受，否则丢弃。

![](https://i.imgur.com/U4hXtY5.png)



## 3.3 两种情况下的数据链路层

### 3.3.1 使用点对点信道的数据链路层(广域网)

- PPP协议(point to point protocol)，是数据链路层协议，**用于长距离拨号上网**。
- PPP协议应该满足：
  简单；封装成帧；透明性；多种网络层协议；多种类型链路；差错检验；检测连接状态；最大传送单元；网络层地址协商；数据压缩协商；
- PPP协议不需要满足：
  纠错；流量控制；序号；多点链接；半双工或单工连接。
- PPP协议的组层部分：
  数据链路层协议可以用于异步串行或同步串行介质；
  使用LCP(链路控制协议)建立并维护数据链路连接，可以实现身份验证和欠费管理；
- PPP协议帧格式
  标志字段F = 0x7E
  地址字段A = 0xFF，它并不起作用
  控制字段C = 0x03
  PPP协议是面向字节的，所以所有的PPP帧的长度都是整数字节。

![](https://i.imgur.com/1GHhUt6.png)



## 3.3.2 使用广播信道的数据链路层(局域网)

一般是总线型。
(1)局域网的拓扑

![](https://i.imgur.com/7lvuqXB.png)

(2)共享通信媒体
静态划分信道(麻烦)：
频分复用；时分复用；波分复用；码分复用；
动态媒体接入控制(多点接入)：
随机接入(主要是以太网)；受控接入，如多点线路探询(polling)，轮询(不采用了)。

(3)认识以太网
最初的以太网是将许多计算机都连接到一根总线上，当初认为这样连接即简单又可靠，因为总线上没有有源器件。
总线上每一个主机都能检测到B发送的数据。但是只有D的地址和数据帧首部写入的地址一致，所以只有D接收。其余计算机都能检测到这不是发送给他们的数据帧，所以就丢弃这个数据帧。
这是一种具有广播特性的总线上实现了一对一通信。这种方式<u>不安全</u>。

(4)带冲突检测的载波监听/碰撞检测
CSMA/CD：
Carrier Sense Multiple Access with Collision Detection
多点接入： 许多计算机以多点接入的方式连接在一根总线上。
载波监听： 每一个站在发送数据之前都先要用电子技术检测一下总线时候有其它计算机在发送数据信号，如果有则不发送数据，以免发生碰撞；

(5)**碰撞检测**
碰撞检测就是计算机边发送数据边检测信道上信号电压的大小。
当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大；
当一个站检测到信号电压摆动值超过一定的门限值时，就认为总线上至少有两个站在同时发送数据，表明产生了碰撞；
碰撞就是冲突，碰撞检测也称冲突检测。
**检测到碰撞后：**

- 在发生碰撞时，总线上传输的信号产生了严重的失真，无法从中恢复出有用的信息；
- 每一个正在发送数据的站，一旦发现总线上出现了碰撞，就**立即停止发送**，避免浪费网络资源，等待一个随机的时间后再次发送。



(6)传播时延对载波监听的影响

![](https://i.imgur.com/Adlc0Tj.png)

在2t时间内，可能存在碰撞。

(7)CSMA/CD的重要特性
使用CSMA/CD协议的以太网**不能进行全双工通信**而<u>**只能**</u>进行双向交替通信(**<u>半双工</u>**)；
每个站在发送数据之后的一小段时间内，存在着遭遇碰撞的可能；
这种发送的**不确定性使整个以太网的平均通信量远小于以太网的最高数据率**。

(8)争用期
最先发送数据帧的站，在发送数据帧后至多经过时间2t(2倍的端到端往返时延)就可知道发送的数据帧是否发生了碰撞。
经过争用期这段时间还没有检测到碰撞，就可以肯定不会发生碰撞；
以太网的争用期：
->以太网的端到端往返时延2t称为争用期，或碰撞窗口，通常取51.2微秒为争用期的长度；如果网线过长，会导致争用期时间的延长，这也是为什么网线一般不超过100m；
->对于10Mb/s的以太网，在争用期可以发送512bit，也就是64 byte；
->以太网在发送数据的时候，若前64字节没有冲突，后续也不会发生冲突；
最短有效帧长：
->如果发生冲突，一定是前64字节；
->由于一旦发生冲突就立刻停止，所以已发送的数据一定小雨64字节；
->以太网规定了最短有效帧长为64字节，凡事小雨64字节的帧一定是因为冲突而异常终止的无效帧。

(9)二进制指数类型退避算法
发送碰撞的站在停止发送数据后，要推迟一个随机事件才能发送数据。
确定基本退避时间，一般是争用期2t；
定义参数**k = min(重传次数，10)；**
从整数集合{0,1,…,2**^k^**-1}中随机取出一个数，记为r，重传所需的时延就是**r倍**的基本退避时间；
当重传达16次时仍不能成功时就丢弃该帧，并向高层报告。

广播信道：星形网和总线网



## 3.4 以太网

### 3.4.1 以太网的两个标准

DIX Ethernet V2一般是指这个。
IEEE 802.3 两个标准差别很小。
以太网 是满足DIX Ethernet V2标准的局域网。

### 3.4.2 以太网与数据链路层的2个子层

为了使数据链路层更好的适应多种局域网标准，802委员会把局域网拆分为：

- **逻辑链路控制LLC(Logical Link Control)**子层；
- 媒体接入控制MAC(Medium Access Control)**子层。**       ***
  

### 3.4.3 以太网提供的服务

以太网提供服务是不可靠的交付，即<u>最大努力的交付</u>；
当接收站收到的有差错的数据帧时就丢弃此帧，其它什么也不做，差错的纠正由高层来处理；
如果高层发现丢失了一些数据而进行重传，但以太网并不知道这是一个重传的帧，而是当作一个新帧发送。

### 3.4.4 以太网的星型拓扑结构

物理上是星型，逻辑上是总线型。

![](https://i.imgur.com/J1ft66n.png)

每条线100米

### 3.4.5 集线器的特点

的以太网那样运行。由于集线器使用了大规模集成电路芯片，所以可靠性更高；
使用集线器逻辑上仍然是一个总线网，各工作站使用的还是CSMA/CD协议，共享逻辑网络上的总线；
集线器像一个**多接口的转发器**，工作在物理层。

![](https://i.imgur.com/dXs7DXY.png)



### 3.4.6 10Base-T 基于集线器的以太网标准

它的通信距离稍短，每个站到集线器的距离不超过100m。
这种10MB/s的无屏蔽双绞线星形网的出现，能降低成本和提高可靠性。
10Base-T（以太网的标准）的出现有很大的意义，类似标准有100Base-FX，10Base-T，100Base-T4.

### 3.4.7 信道利用率

争用期长度为2t；帧长为L bit，数据发送旅为C b/s，帧的发送时间为L/C = T0 秒。
一个帧从开始发送，经可能发生的碰撞后，将再次重传多次，直到发送成功且信道转为空闲(即再经过t使得信道上没有信号在传播)时为止，是发送一帧所需的平均时间。

![](https://i.imgur.com/kF2BAbN.png)

定义a = t / T0，是单程端到端时延t与帧发送时间T0的比值。a越小，说明碰撞检测越快，信道利用率高。
当数据率(网速)一定时，以太网的连线长度受到限制，否则t会太长；
以太网的帧长不能太短，否则T0太小，使a太大。

### 3.4.8 信道利用率的最大值

假设理想状态下，以太网个展发送的数据都不会碰撞，一旦总线空闲就能有站立即发送数据，所以没有争用期；
发送一帧需要占用总线T0+t，而帧本身需要发送时间为T0，于是理想情况下极限信道利用率Smax = T0 / (T0 + t) = 1 / (1 + a).

## 3.5 MAC层

### 3.5.1 MAC层的硬件地址(MAC地址)

硬件地址 = 物理地址 = MAC地址
MAC地址前3个字节(24位)是厂家分配的地址字段，后3个字节(24位)是厂家自定义，称为扩展标识符；
一个地址块可以产生2^24个地址，这种48位地址称为MAC-48，通用名为EUI-48，这就是MAC地址；
MAC地址实际上是每一个站的名字或标识符。



3.5.2 适配器检查MAC地址
适配器从网络上每收到一个MAC帧就要用硬件检查MAC帧中的MAC地址：
->如果是发往本站的帧就收下，然后进行其它处理；
->否则丢弃。
发往本站的帧包括：
->单播帧(unicast)(一对一)
->广播帧(broadcast)(一对全体)
->多播帧(multicast)(一对多)

3.5.3 MAC帧的格式
6 + 6 + 2 + 46 + 4 =64 byte，这就是为什么IP数据报的最短长度为46字节。

![](https://i.imgur.com/qXX2d4I.png)

收到后回吧FCS删掉



## 3.7.2 在数据链路层考虑扩展

(1)网桥 (交换机前身)
网桥工作在数据链路层，他根据MAC帧的目的地址对收到的帧进行转发。网桥具有过滤帧的功能。当网桥收到一个帧时，并不是向所有的接口转发此帧，而是现检查此帧的目的MAC地址，然后再确定将该帧转发到对应的接口。

![](https://i.imgur.com/jgPGA4G.jpg)



(2)交换机
随着网桥的接口的增加， 后来网桥和集线器合并了，计算机可以直接和交换机连接，这就是交换机。
交换机就是网桥和集线器的合并升级版，能全双工，安全通信。

- 端口带宽独享；
- 安全；
- 基于MAC地址转发；
- 通过学习构建MAC地址表。

![](https://i.imgur.com/xioImMr.jpg)

## 3.8 快速以太网(fast ethernet)

### 3.8.1 100Base-T以太网 （fast ethernet）

- TX: 双绞线
- FX：光纤
- 可以全双工

### 3.8.3 吉比特Gbit以太网

- 半双工使用CSMA/CD协议
- 全双工不适用CSMA/CD协议
- 光纤SX 短波长
- 光纤LX 长波长
- CX 铜线

### 3.8.4 10Gbit/s以太网

## 3.8.6 Cisco建网的3层模型



# 第四章： 网络层 Network layer















